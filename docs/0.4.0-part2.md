# JiLang 0.4.0 更新日志 (Part 2)

## HTTP 模块实现

JiLang 0.4.0 版本新增了强大的 HTTP 模块，为语言添加了与网络服务交互的能力。

### 主要功能

- **HTTP 请求方法**：支持标准的 HTTP 方法，包括 GET、POST、PUT 和 DELETE
- **请求头管理**：支持自定义请求头，轻松实现身份验证和内容类型设置
- **自动 JSON 处理**：自动解析 JSON 响应，方便数据操作
- **URL 编码/解码**：提供 URL 编码和解码功能
- **错误处理**：完善的错误处理机制，轻松识别和处理网络错误
- **超时设置**：支持请求超时配置

### 模块 API

模块提供以下主要函数：

- `http.get(url, [headers], [timeout])`：执行 GET 请求
- `http.post(url, body, [headers], [timeout])`：执行 POST 请求
- `http.put(url, body, [headers], [timeout])`：执行 PUT 请求
- `http.delete(url, [headers], [timeout])`：执行 DELETE 请求
- `http.url_encode(text)`：URL 编码文本
- `http.url_decode(encoded_text)`：URL 解码文本

### 问题修复

- 修复了变量引用解析问题，改进了 `context.resolve_value()` 的处理逻辑
- 增强了对嵌套属性的支持，例如 `@var.response.body.items`
- 修复了调试模式下嵌套属性显示问题，通过提取值到独立变量解决
- 优化了请求头和请求体的处理，支持多种格式

### 示例改进

更新了多个示例文件以展示 HTTP 模块的功能：

1. **http_short_test.jl**：简化的 GET 请求测试
2. **http_core_test.jl**：所有 HTTP 方法的集成测试
3. **http_json_fetch_save.jl**：与 IO 模块集成的完整应用示例

### 技术细节

- 基于 reqwest 库实现，提供可靠的 HTTP 客户端功能
- 使用 serde_json 进行 JSON 序列化和反序列化
- 支持阻塞式网络请求，适合 JiLang 的执行模型
- 提供统一的响应格式，包括状态码、响应头和响应体

### 未来计划

- 支持文件上传
- 添加 WebSocket 支持
- 实现更多 HTTP 方法（如 PATCH、HEAD 等）
- 添加请求重试机制
- 支持代理服务器配置

## 其他更新

### WindowWV 模块实现

JiLang 0.4.0 版本还引入了 WindowWV 模块，为语言添加了创建图形用户界面的能力，使开发者能够构建具有可视化界面的应用程序。

#### 主要功能

- **WebView 窗口**：创建和管理独立的窗口，用于显示 HTML 内容
- **HTML 渲染**：支持加载和显示 HTML 内容或 URL
- **JS 交互**：建立 JavaScript 和 JiLang 之间的双向通信桥梁
- **事件处理**：支持窗口事件和 DOM 事件捕获与处理
- **窗口控制**：动态修改窗口标题、大小和可见性

#### 模块 API

WindowWV 模块提供以下主要函数组：

1. **基本窗口操作**
   - `windowwv.create`：创建新窗口
   - `windowwv.show`：显示窗口
   - `windowwv.close`：关闭窗口
   - `windowwv.set_title`：设置窗口标题
   - `windowwv.set_size`：设置窗口尺寸

2. **内容管理**
   - `windowwv.load_html`：加载HTML内容
   - `windowwv.load_url`：加载URL
   - `windowwv.eval`：执行JavaScript代码

3. **交互与事件**
   - `windowwv.bind`：将JavaScript函数绑定到JiLang函数
   - `windowwv.invoke`：从JiLang调用JavaScript函数
   - `windowwv.on`：设置事件处理程序

4. **事件循环**
   - `windowwv.run`：运行单个窗口的事件循环
   - `windowwv.run_all`：运行所有窗口的事件循环

#### 示例应用

新增了多个示例来展示 WindowWV 模块的功能：

1. **simple_windowwv.jl**：基本窗口创建和显示
2. **test_windowwv.jl**：模块功能全面测试
3. **windowwv_calculator.jl**：完整的计算器应用，展示了 JS 和 JiLang 交互

#### 技术细节

- 基于 wry 跨平台 WebView 库实现
- 使用 Rust 原生线程处理事件循环
- 支持窗口的线程安全操作
- 提供简单的返回值机制，便于与其他 JiLang 模块集成

#### 限制与改进计划

当前版本的已知限制：
- 窗口右上角关闭按钮在某些平台上可能需要使用自定义关闭按钮替代
- JavaScript 与 JiLang 的通信目前是简化的单向实现，将在未来版本完善
- 事件循环会阻塞主线程，未来将支持异步模式

计划在后续版本中添加：
- 多窗口管理功能
- 完整的 JS-JiLang 双向通信
- 文件拖放支持
- 系统托盘集成
- 窗口截图功能
