# JiLang HTTP模块设计文档

## 模块设计概述

HTTP模块是JiLang的内置模块，旨在提供网络请求功能。本文档详细说明了该模块的设计考虑、实现细节和代码结构。

## 设计目标

1. 提供简洁易用的HTTP请求API
2. 支持常见的HTTP方法（GET、POST、PUT、DELETE）
3. 允许设置请求头和请求体
4. 自动处理JSON格式的请求和响应
5. 提供URL编码/解码功能
6. 实现良好的错误处理机制

## 语法设计

### 函数命名

HTTP模块的函数命名采用小写单词，符合JiLang的一般命名约定。主要函数包括：

- `get`：发送GET请求
- `post`：发送POST请求
- `put`：发送PUT请求
- `delete`：发送DELETE请求
- `url_encode`：URL编码
- `url_decode`：URL解码

### 参数设计

对于HTTP请求函数，采用了统一的参数模式：

1. 第一个参数总是URL
2. 对于需要请求体的方法（POST/PUT），第二个参数为请求体
3. 请求头作为可选参数
4. 超时设置作为最后一个可选参数

这种设计保持了一致性，同时使得常见用例简单明了。

### 返回值设计

所有HTTP请求函数返回统一的响应对象结构：

```json
{
  "status": 200,                // HTTP状态码
  "headers": { ... },           // 响应头
  "body": { ... },              // 响应体（自动解析JSON或原始文本）
  "raw": "原始响应文本"          // 原始响应文本
}
```

如果请求失败，则返回：

```json
{
  "error": "错误信息"
}
```

## 实现细节

### 依赖选择

模块实现选择了以下Rust依赖：

- **reqwest**：成熟的HTTP客户端库，支持阻塞和异步操作
- **urlencoding**：提供URL编码/解码功能
- **serde_json**：处理JSON数据序列化和反序列化

选择`reqwest`的理由：

1. 广泛使用和良好维护
2. API简洁易用
3. 提供阻塞模式，适合JiLang的执行模型
4. 内置错误处理机制

### 代码结构

HTTP模块的代码结构遵循JiLang的模块实现模式：

1. **公共接口**：通过`HttpModule`结构体实现的`Module`trait提供
2. **函数实现**：每个HTTP方法和辅助函数作为`HttpModule`的静态方法实现
3. **共享逻辑**：通过`execute_request`函数减少代码重复
4. **辅助函数**：如`parse_headers`和`parse_number`提供通用功能

### 请求处理流程

1. **参数解析**：从JiLang值中提取URL、请求头等参数
2. **构建请求**：使用reqwest库创建请求对象
3. **发送请求**：执行HTTP请求
4. **处理响应**：解析响应状态、头和体
5. **自动JSON解析**：尝试将响应体解析为JSON
6. **返回结果**：构建包含请求结果的JSON对象

### 错误处理机制

HTTP模块采用了统一的错误处理模式：

1. 请求构建或发送失败时，返回包含`error`字段的对象
2. 响应解析失败时，尽可能提供有用的错误信息
3. 对于边缘情况（如无效URL），提供明确的错误消息

## 安全性考虑

1. **输入验证**：验证传入的URL和其他参数
2. **错误信息**：确保错误信息不暴露敏感信息
3. **资源限制**：通过超时机制防止资源耗尽

## 性能优化

1. **阻塞模式**：使用reqwest的阻塞客户端，与JiLang执行模型匹配
2. **连接复用**：reqwest客户端默认支持连接池
3. **内存管理**：避免不必要的内存复制和分配

## 未来扩展

以下功能可在后续版本中考虑添加：

1. **异步请求**：支持非阻塞HTTP请求
2. **websocket支持**：实现WebSocket客户端功能
3. **更多请求方法**：如PATCH、HEAD、OPTIONS等
4. **请求重试机制**：自动重试失败的请求
5. **代理支持**：通过代理服务器发送请求
6. **客户端证书**：支持TLS客户端证书验证

## 测试策略

模块测试分为以下几个方面：

1. **单元测试**：测试各个组件的独立功能
2. **集成测试**：通过模拟服务器测试完整流程
3. **JiLang测试用例**：通过JiLang程序测试模块功能

## 与其他模块的集成

HTTP模块可以与以下JiLang模块协同工作：

1. **io模块**：将HTTP响应保存到文件或从文件读取请求数据
2. **math模块**：处理和验证数值型响应数据 